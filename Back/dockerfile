# JDK ì„¤ì • (Alpine ê¸°ë°˜)
FROM openjdk:17-jdk-alpine

# ì‘ì—… í´ë” ì„¤ì •
WORKDIR /app

# í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apk update && apk add findutils coreutils

# ë¹Œë“œ íŒŒì¼ ë³µì‚¬
COPY gradlew .
COPY gradlew.bat .
COPY gradle gradle
COPY build.gradle .
COPY settings.gradle .
COPY src src

# í˜¹ì‹œëª¨ë¥¼ ê¶Œí•œì„¤ì •
RUN chmod +x gradlew

# ë¹Œë“œ
RUN ./gradlew build

# [DEBUG] ë¹Œë“œ í›„ í´ë” ê²€ì‚¬...
RUN ls -al build/libs
RUN ls -al build

# [DEBUG] ë¹Œë“œëœ JAR íŒŒì¼ì˜ ì ˆëŒ€ ê²½ë¡œ í™•ì¸
RUN realpath build/libs/backend-app.jar

# ê²°ê³¼ íŒŒì¼ ë³µì‚¬
COPY build/libs/*.jar /app/backend.jar

# í¬íŠ¸ ì„¤ì • (nginxì—ì„œ í”„ë¡ì‹œí•  ê²ƒ)
EXPOSE 8080

# Run ğŸš€
CMD ["java", "-jar", "backend.jar"]
